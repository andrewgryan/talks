<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <title>CLIMAR - Technical Workshop</title>
      <script type="module" crossorigin src="/talks/assets/index.5a20bf30.js"></script>
      <link rel="modulepreload" href="/talks/assets/vendor.ecee89d3.js">
      <link rel="stylesheet" href="/talks/assets/index.1978af95.css">
    </head>
    <body>
        <div
            class="
                reveal
                tw-bg-gradient-to-b
                tw-from-blue-500
                tw-via-blue-300
                tw-to-blue-100
            "
        >
            <div class="slides">
                <section>
                    <h2>Scaling software</h2>
                    <h5>Andy Ryan</h5>
                    <div class="tw-font-thin tw-tracking-wider tw-font-mono">
                        R Shiny case study
                    </div>
                </section>

                <section>
                    <h3>Pre-talk talk</h3>
                    <ul>
                        <li class="fragment">Anyone not got R Studio?</li>
                        <li class="fragment">Tell me your GitHub handle</li>
                        <li class="fragment">
                            I'll add you to my repo collaborators list
                        </li>
                        <li class="fragment">
                            Or fork my repo if you know how
                        </li>
                        <li class="fragment">
                            <a
                                href="https://github.com/andrewgryan/climar-technical-workshop"
                                >andrewgryan/climar-technical-workshop</a
                            >
                        </li>
                    </ul>
                </section>
                <section>
                    <h3>Talk Outline</h3>
                    <ul>
                        <li class="fragment">Principles of software design</li>
                        <li class="fragment">
                            Functional programming overview
                        </li>
                        <li class="fragment">
                            SOLID principles via R-Shiny example
                        </li>
                        <li class="fragment">Refactoring techniques</li>
                        <li class="fragment">Engineering practices</li>
                        <li class="fragment">Practical session</li>
                    </ul>
                </section>
                <section>
                    <section>
                        <h1>Clean Code</h1>
                    </section>

                    <section>
                        <h3>What is it?</h3>
                        <ul>
                            <li class="fragment">
                                Hard won lessons by software engineers
                            </li>
                            <li class="fragment">
                                The nitty gritty bits of code that add up to a
                                well-designed system
                            </li>
                            <li class="fragment">
                                Indentation, comments, naming conventions,
                                abstractions ...
                            </li>
                        </ul>
                    </section>

                    <section>
                        <img
                            src="https://blog.codinghorror.com/content/images/uploads/2009/02/6a0120a85dcdae970b012877707a45970c-pi.png"
                            alt=""
                        />
                    </section>

                    <section>
                        <h2>Comments</h2>
                    </section>

                    <section>
                        <h4>Good practice</h4>
                        <ul>
                            <li class="fragment">
                                Add knowledge not in the executable code
                            </li>
                            <li class="fragment">
                                Break up blocks into logical steps
                            </li>
                            <li class="fragment">Signal intention</li>
                            <li class="fragment">Highlight TODOs or NOTEs</li>
                            <li class="fragment">
                                Document function signatures
                            </li>
                        </ul>
                        <pre class="R fragment"><code data-trim>
result &lt;- foo(bar=TRUE) # TODO remove need for bar

someFunc(date) # Only works with RFC3339 dates
                        </code></pre>
                    </section>
                    <section>
                        <h4>Bad practice</h4>
                        <ul>
                            <li class="fragment">
                                Repeat information available in source code
                            </li>
                            <li class="fragment">
                                Comment out chunks of code for later use
                            </li>
                            <li class="fragment">
                                Go overboard commenting everything
                            </li>
                        </ul>
                        <pre class="R fragment"><code data-trim>
result &lt;- foo(bar=TRUE) # result using foo when bar is TRUE

# someFunc(date_0)
someFunc(rfcDate)
# someFunc(date2 - 1999)
# someFunc(date * 1e9)
                        </code></pre>
                    </section>

                    <section>
                        <p style="font-size: 1.2rem">Identifiers</p>
                        <h3>Names</h3>
                        <ul>
                            <li class="fragment">Naming is hard</li>
                            <li class="fragment">
                                Rename variables, functions and modules until
                                they don't need to change anymore
                            </li>
                            <li class="fragment">
                                Use intention revealing names
                            </li>
                            <li class="fragment">Use pronounceable names</li>
                            <li class="fragment">Avoid mental-mapping</li>
                            <li class="fragment">Don't use puns</li>
                        </ul>
                    </section>

                    <section>
                        <h3>More detailed information</h3>
                        <div class="tw-flex tw-flex-row">
                            <img
                                class="tw-w-full tw-transform tw-scale-75"
                                src="https://m.media-amazon.com/images/I/41SH-SvWPxL.jpg"
                                alt=""
                            />
                            <img
                                class="tw-w-full tw-transform tw-scale-75"
                                src="https://images-na.ssl-images-amazon.com/images/I/61HEMOo48hL.jpg"
                                alt=""
                            />
                        </div>
                    </section>
                </section>
                <section>
                    <section>
                        <h4>Functional programming paradigm</h4>
                        <p class="fragment">Pure function properties</p>
                        <ul>
                            <li class="fragment">No side-effects</li>
                            <li class="fragment">Referential transparency</li>
                            <li class="fragment">Immutable data structures</li>
                            <li class="fragment">Easy to compose</li>
                            <li class="fragment">Thread safe by default</li>
                        </ul>
                    </section>
                    <section>
                        <h3>Learn more</h3>
                        <p>
                            Check out Scott Wlaschin's talk as a good place to
                            start learning functional programming
                        </p>
                        <iframe
                            width="560"
                            height="315"
                            src="https://www.youtube.com/embed/oquuPOkz8xo?start=180"
                            title="YouTube video player"
                            frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen
                        ></iframe>
                    </section>
                </section>
                <section>
                    <section>
                        <p style="font-size: 1.2rem">Object-oriented design</p>
                        <h3>SOLID principles</h3>
                        <ul>
                            <li class="fragment">
                                <span class="tw-font-bold">S</span>ingle
                                responsibility
                            </li>
                            <li class="fragment">
                                <span class="tw-font-bold">O</span>pen-closed
                            </li>
                            <li class="fragment">
                                <span class="tw-font-bold">L</span>iskov
                                substitution
                            </li>
                            <li class="fragment">
                                <span class="tw-font-bold">I</span>nterface
                                segregation
                            </li>
                            <li class="fragment">
                                <span class="tw-font-bold">D</span>ependency
                                inversion
                            </li>
                        </ul>
                    </section>
                    <section>
                        <h3>Single Responsibility principle</h3>
                        <div class="tw-flex tw-flex-col">
                            <div class="tw-text-gray-600 tw-italic tw-p-2">
                                "Do one thing and do it well"
                            </div>
                            <div class="tw-pl-1 tw-font-semibold tw-text-sm">
                                Unix philosophy
                            </div>
                        </div>
                        <pre
                            class="R fragment"
                        ><code data-trim data-line-numbers="1-9|2-7|8">
function hazardColors(data, symmetricAboutZero=FALSE) {
    if (symmetricAboutZero) {
        extent &lt;- max(abs(min(data), max(data)))
        domain &lt;- c(-extent, +extent)
    } else {
        domain &lt;- c(0, max(data)) # Default domain
    }
    leaflet::colorBin("Reds", domain = domain)
}
                        </code></pre>
                        <ul>
                            <li class="fragment">
                                Responsible for domain and color palette
                            </li>
                            <li class="fragment">
                                Hard to re-use calculation logic
                            </li>
                        </ul>
                        <p class="fragment tw-font-bold">
                            Violates single responsibility principle
                        </p>
                    </section>
                    <section>
                        <h3>Single Responsibility principle</h3>
                        <p class="fragment">Better approach</p>
                        <pre
                            class="R fragment"
                        ><code data-trim data-line-numbers="1-10|1-3|4-7|8-10">
function hazardColors(domain) {
    leaflet::colorBin("Reds", domain = domain)
}
function symmetricAboutZero(data) {
    extent &lt;- max(abs(min(data), max(data)))
    c(-extent, +extent)
}
function positiveDefinite(data) {
    c(0, max(data))
}
                        </code></pre>
                        <ul>
                            <li class="fragment">
                                Each function has one responsibility
                            </li>
                            <li class="fragment">
                                Easy to re-use calculation logic
                            </li>
                        </ul>
                        <p class="fragment tw-font-bold">
                            Satisfies single responsibility principle
                        </p>
                    </section>

                    <section>
                        <h3>Dependency inversion principle</h3>
                        <div class="tw-flex tw-flex-col">
                            <div class="tw-text-gray-600 tw-italic tw-p-2">
                                "Program to an interface, not an implementation"
                            </div>
                            <div class="tw-pl-1 tw-font-semibold tw-text-sm">
                                Gang of four
                            </div>
                        </div>
                        <pre
                            class="R fragment"
                        ><code data-trim data-line-numbers="1-10|1-3|4-10">
function hazardColors(data, domainType) {
  colorBin("Reds", domain=calculateDomain(data, domainType))
}
function calculateDomain(data, domainType) {
  if (domainType == 'symmetric') {
    return(symmetricAboutZero(data))
  } else {
    return(positiveDefinite(data))
  }
}
                        </code></pre>
                        <ul>
                            <li class="fragment">
                                Domain calculation nested inside functions
                            </li>
                            <li class="fragment">
                                Hard to add a new algorithm
                            </li>
                        </ul>
                        <p class="fragment tw-font-bold">
                            Violates dependency inversion
                        </p>
                    </section>

                    <section>
                        <h3>Dependency inversion principle</h3>
                        <p class="fragment">Solution</p>
                        <pre
                            class="R fragment"
                        ><code data-trim data-line-numbers="1-10|1-3|4-10">
function hazardColors(domain) {
  colorBin("Reds", domain=domain)
}
palette &lt;- hazardColors(symmetricAboutZero(data))
                        </code></pre>
                        <ul>
                            <li class="fragment">
                                Domain calculation explicit to reader
                            </li>
                            <li class="fragment">
                                Easy to add a new algorithm
                            </li>
                            <li class="fragment">
                                No need for magical strings
                            </li>
                            <li class="fragment">Less code</li>
                        </ul>
                        <p class="fragment tw-font-bold">
                            Satisfies Dependency Inversion Principle
                        </p>
                    </section>

                    <section>
                        <h3>Interface segregation principle</h3>
                        <p class="fragment">Example</p>
                        <pre
                            class="R fragment"
                        ><code data-trim data-line-numbers="1-10|2-3|4-5">
# colorBar.R
library(leaflet)
function hazardColors(domain) { ... }
function symmetricAboutZero(data) { ... }
function positiveDefinite(data) { ... }
                        </code></pre>
                        <ul>
                            <li class="fragment">
                                Domain calculations shouldn't need leaflet
                            </li>
                            <li class="fragment">
                                What if I want limits for a ggplot?
                            </li>
                            <li class="fragment">
                                Should I install.packages(leaflet)?
                            </li>
                        </ul>
                        <p class="fragment tw-font-bold">
                            Interface segregation violation
                        </p>
                    </section>

                    <section>
                        <h3>Interface segregation principle</h3>
                        <p class="fragment">Solution</p>
                        <pre
                            class="R fragment"
                        ><code data-trim data-line-numbers="1-10">
# colorBar.R
library(leaflet)
function hazardColors(domain) { ... }
                        </code></pre>
                        <pre
                            class="R fragment"
                        ><code data-trim data-line-numbers="1-10">
# domain.R
function symmetricAboutZero(data) { ... }
function positiveDefinite(data) { ... }
                        </code></pre>
                        <ul>
                            <li class="fragment">
                                Domain module has no dependencies
                            </li>
                            <li class="fragment">
                                Color module has fewer more precise functions
                            </li>
                        </ul>
                        <p class="fragment tw-font-bold">
                            Module interface segregated
                        </p>
                    </section>

                    <section>
                        <h3>Interface segregation principle</h3>
                        <p>Example of function interface segregation</p>
                        <pre
                            class="R fragment"
                        ><code data-trim data-line-numbers="1-11|3,5|4,7|1-11">
# Bloated interface
function makePizza(toppings,
                   water, salt, yeast, flour00,
                   ovenType, temperature) {
    dough &lt;- makeDough(flour00, water, salt, yeast)
    pizzaBase &lt;- addToppings(dough, toppings)
    cook(pizzaBase, ovenType, temperature)
}
pizza &lt;- makePizza(c(mozzarella, basil, tomatoSauce),
                   water, salt, yeast, flour00,
                   woodFired, 500C)

                        </code></pre>
                        <ul>
                            <li class="fragment">
                                3 independently varying interfaces
                            </li>
                            <li class="fragment">What if cook() needs time?</li>
                            <li class="fragment">makePizza(..., time)?</li>
                        </ul>
                    </section>
                    <section>
                        <h3>Interface segregation principle</h3>
                        <p>Same code, less repetition.</p>
                        <pre
                            class="R fragment"
                        ><code data-trim data-line-numbers="1-10|4">
toppings &lt;- c(mozzarella, basil, tomatoSauce)
pizza &lt;- makeDough(flour00, water, salt, yeast) %&gt;%
    addToppings(toppings) %&gt;%
    cook(woodFired, 500C)
                        </code></pre>
                        <ul>
                            <li class="fragment">
                                Function composition operator builtin to R
                            </li>
                            <li class="fragment">
                                <code>cook(woodFired, 500C, tenMinutes)</code>
                            </li>
                        </ul>
                    </section>
                </section>

                <section>
                    <p style="font-size: 1.2rem">Don't repeat yourself</p>
                    <h3>DRY</h3>
                    <div class="tw-flex tw-flex-col">
                        <div class="tw-text-gray-600 tw-italic tw-p-2">
                            "Every piece of knowledge must have a single,
                            unambiguous, authorative representation within a
                            system."
                        </div>
                        <div class="tw-pl-1 tw-font-semibold tw-text-sm">
                            Pragmatic programmer (Andrew Hunt, David Thomas)
                        </div>
                    </div>
                </section>
                <section>
                    <p style="font-size: 1.2rem">Write everything twice</p>
                    <h3>WET</h3>
                    <div class="tw-flex tw-flex-col">
                        <div class="tw-text-gray-600 tw-italic tw-p-2">
                            Duplication is far cheaper than the wrong
                            abstraction
                        </div>
                        <div class="tw-pl-1 tw-font-semibold tw-text-sm">
                            - Sandi Metz
                        </div>
                    </div>
                </section>

                <section>
                    <h1>Engineering Practices</h1>
                </section>

                <section>
                    <section>
                        <h3>Version control</h3>
                        <div class="tw-flex tw-flex-col tw-items-center">
                            <img
                                class="
                                    tw-object-cover
                                    tw-object-bottom
                                    tw-h-36
                                    tw-w-72
                                    tw-transform
                                    tw-scale-150
                                "
                                src="https://wac-cdn.atlassian.com/dam/jcr:1523084b-d05a-4f5a-bd1a-01866ec09ca3/01%20A%20forked%20commit%20history.svg?cdnVersion=99"
                                alt=""
                            />
                            <p>Time travel and parallel universes</p>
                        </div>
                    </section>
                    <section>
                        <h5>Become a Git Guru</h5>
                        <a href="https://www.atlassian.com/git/tutorials">
                            <img
                                class="tw-object-contain tw-w-full"
                                src="/talks/screenshot-atlassian.png"
                                alt=""
                            />
                        </a>
                    </section>
                    <section>
                        <h4>
                            Git 101 -
                            <a
                                href="https://www.atlassian.com/git/tutorials/atlassian-git-cheatsheet"
                                >cheatsheet</a
                            >
                        </h4>
                        <pre
                            class="bash fragment"
                        ><code>git clone ${repo}  # Copy a repository</code></pre>
                        <pre
                            class="bash fragment"
                        ><code>git checkout -b ${branch}  # Create and checkout branch</code></pre>
                        <pre class="bash fragment"><code data-trim>
# Add file to repository
git add ${file}
                        </code></pre>
                        <pre class="bash fragment"><code data-trim>
# Add changes and commit with message
git commit -a -m 'message'
                        </code></pre>
                        <pre
                            class="bash fragment"
                        ><code>git push  # Send commits to remote repository</code></pre>
                        <pre
                            class="bash fragment"
                        ><code>git pull  # Fetch and merge commits from remote repository</code></pre>
                    </section>
                </section>

                <section>
                    <section>
                        <h1>Refactoring</h1>
                        <div class="tw-flex tw-flex-col">
                            <div class="tw-text-gray-600 tw-italic tw-p-2">
                                "If it smells bad, change it"
                            </div>
                            <div class="tw-pl-1 tw-font-semibold tw-text-sm">
                                Kent Beck's grandmother
                            </div>
                        </div>
                    </section>
                    <section>
                        <h5>Refactoring Guru</h5>
                        <iframe
                            id="refactoring"
                            class="tw-w-full tw-h-screen"
                            src="https://refactoring.guru/refactoring/catalog"
                            frameborder="0"
                        ></iframe>
                    </section>
                </section>

                <section>
                    <h3>Pair programming</h3>
                    <img
                        src="https://martinfowler.com/articles/on-pair-programming/benefits_overview.jpg"
                        alt=""
                    />
                </section>
                <section>
                    <h3>Automated tests</h3>
                    <img
                        src="https://martinfowler.com/articles/practical-test-pyramid/testPyramid.png"
                        alt=""
                    />
                    <div class="tw-text-sm tw-pb-4">The testing pyramid</div>
                    <ul>
                        <li class="fragment">Test driven development - TDD</li>
                        <li class="fragment">
                            Integration tests - GitHub actions
                        </li>
                    </ul>
                </section>

                <section>
                    <h1>Practical session</h1>
                </section>

                <section>
                    <h3>Task</h3>
                    <ul>
                        <li>Work alone or in pairs</li>
                        <li>Add a feature to an example</li>
                        <ul>
                            <li class="fragment">Create a branch</li>
                            <li class="fragment">Submit a pull request</li>
                        </ul>
                    </ul>
                </section>

                <section>
                    <h1>Summary</h1>
                    <ul>
                        <li>Separate concerns</li>
                        <li>Use version control</li>
                        <li>Pair program &amp; code review</li>
                        <li>Extract re-usable code</li>
                        <li>But not too early</li>
                    </ul>
                </section>
            </div>
        </div>
        
    </body>
</html>
